var chatboxFocus=new Array,chatBoxes=new Array,ready=function(){chatBox={chatWith:function(t){chatBox.createChatBox(t),$("#chatbox_"+t+" .chatboxtextarea").focus()},close:function(t){$("#chatbox_"+t).css("display","none"),chatBox.restructure()},notify:function(){var t=$("#chatAudio")[0];t.play()},restructure:function(){align=0;for(x in chatBoxes)chatbox_id=chatBoxes[x],"none"!=$("#chatbox_"+chatbox_id).css("display")&&(0==align||(width=287*align+20),align++)},createChatBox:function(t,e){if($("#chatbox_"+t).length>0)return"none"==$("#chatbox_"+t).css("display")&&$("#chatbox_"+t).css("display","block"),void $("#chatbox_"+t+" .chatboxtextarea").focus();$("body").append('<div id="chatbox_'+t+'" class="chatbox"></div>'),$.get("conversations/"+t,function(e){$("#chatbox_"+t).html(e),$("#chatbox_"+t+" .chatboxcontent").scrollTop($("#chatbox_"+t+" .chatboxcontent")[0].scrollHeight)},"html"),$("#chatbox_"+t).css("bottom","0px"),chatBoxeslength=0;for(x in chatBoxes)"none"!=$("#chatbox_"+chatBoxes[x]).css("display")&&chatBoxeslength++;if(0==chatBoxeslength||(width=287*chatBoxeslength+20),chatBoxes.push(t),1==e){for(minimizedChatBoxes=new Array,$.cookie("chatbox_minimized")&&(minimizedChatBoxes=$.cookie("chatbox_minimized").split(/\|/)),minimize=0,j=0;j<minimizedChatBoxes.length;j++)minimizedChatBoxes[j]==t&&(minimize=1);1==minimize&&($("#chatbox_"+t+" .chatboxcontent").css("display","none"),$("#chatbox_"+t+" .chatboxinput").css("display","none"))}chatboxFocus[t]=!1,$("#chatbox_"+t+" .chatboxtextarea").blur(function(){chatboxFocus[t]=!1,$("#chatbox_"+t+" .chatboxtextarea").removeClass("chatboxtextareaselected")}).focus(function(){chatboxFocus[t]=!0,$("#chatbox_"+t+" .chatboxhead").removeClass("chatboxblink"),$("#chatbox_"+t+" .chatboxtextarea").addClass("chatboxtextareaselected")}),$("#chatbox_"+t).click(function(){"none"!=$("#chatbox_"+t+" .chatboxcontent").css("display")&&$("#chatbox_"+t+" .chatboxtextarea").focus()}),$("#chatbox_"+t).show()},checkInputKey:function(t,e,n){13==t.keyCode&&0==t.shiftKey&&(t.preventDefault(),message=e.val(),message=message.replace(/^\s+|\s+$/g,""),""!=message&&($("#conversation_form_"+n).submit(),$(e).val(""),$(e).focus(),$(e).css("height","44px")));var i=e.clientHeight,o=94;o>i?(i=Math.max(e.scrollHeight,i),o&&(i=Math.min(o,i)),i>e.clientHeight&&$(e).css("height",i+8+"px")):$(e).css("overflow","auto")},toggleChatBoxGrowth:function(t){if("none"==$("#chatbox_"+t+" .chatboxcontent").css("display")){var e=new Array;$.cookie("chatbox_minimized")&&(e=$.cookie("chatbox_minimized").split(/\|/));var n="";for(i=0;i<e.length;i++)e[i]!=t&&(n+=t+"|");n=n.slice(0,-1),$.cookie("chatbox_minimized",n),$("#chatbox_"+t+" .chatboxcontent").css("display","block"),$("#chatbox_"+t+" .chatboxinput").css("display","block"),$("#chatbox_"+t+" .chatboxcontent").scrollTop($("#chatbox_"+t+" .chatboxcontent")[0].scrollHeight)}else{var n=t;$.cookie("chatbox_minimized")&&(n+="|"+$.cookie("chatbox_minimized")),$.cookie("chatbox_minimized",n),$("#chatbox_"+t+" .chatboxcontent").css("display","none"),$("#chatbox_"+t+" .chatboxinput").css("display","none")}}},/**
     * Cookie plugin
     *
     * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
     * Dual licensed under the MIT and GPL licenses:
     * http://www.opensource.org/licenses/mit-license.php
     * http://www.gnu.org/licenses/gpl.html
     *
     */
jQuery.cookie=function(t,e,n){if("undefined"==typeof e){var i=null;if(document.cookie&&""!=document.cookie)for(var o=document.cookie.split(";"),r=0;r<o.length;r++){var a=jQuery.trim(o[r]);if(a.substring(0,t.length+1)==t+"="){i=decodeURIComponent(a.substring(t.length+1));break}}return i}n=n||{},null===e&&(e="",n.expires=-1);var s="";if(n.expires&&("number"==typeof n.expires||n.expires.toUTCString)){var l;"number"==typeof n.expires?(l=new Date,l.setTime(l.getTime()+24*n.expires*60*60*1e3)):l=n.expires,s="; expires="+l.toUTCString()}var c=n.path?"; path="+n.path:"",u=n.domain?"; domain="+n.domain:"",d=n.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),s,c,u,d].join("")}};$(document).ready(ready),$(document).on("page:load",ready);